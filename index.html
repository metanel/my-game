// HTML
<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>משחק החיסכון</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #f0f0f0;
            font-family: Arial, sans-serif;
        }
        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }
        #game-canvas {
            position: absolute;
            top: 0;
            left: 0;
            background-color: #87CEEB;
        }
        #score-display {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 5px;
            font-size: 18px;
            font-weight: bold;
            z-index: 10;
        }
        #date-display {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 5px;
            font-size: 18px;
            font-weight: bold;
            z-index: 10;
        }
        .dialog-box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            border: 2px solid #333;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            z-index: 100;
            display: none;
            width: 80%;
            max-width: 400px;
        }
        .dialog-box h3 {
            margin-top: 0;
        }
        .dialog-box button {
            margin: 5px;
            padding: 8px 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        .dialog-box button:hover {
            background-color: #45a049;
        }
        .dialog-box button.no-btn {
            background-color: #f44336;
        }
        .dialog-box button.no-btn:hover {
            background-color: #d32f2f;
        }
        #game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            z-index: 100;
            display: none;
        }
        #game-over button {
            margin-top: 20px;
            padding: 8px 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        #win-screen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            z-index: 100;
            display: none;
        }
        #win-screen button {
            margin-top: 20px;
            padding: 8px 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        .speech-bubble {
    position: absolute;
    background-color: rgba(255, 255, 255, 0.9);
    border: 2px solid #333;
    border-radius: 10px;
    padding: 5px;
    font-size: 14px;
    width: 100px;
    text-align: center;
    z-index: 5;
}
        .speech-bubble:after {
            content: "";
            position: absolute;
            bottom: -10px;
            left: 50%;
            margin-left: -5px;
            border-width: 10px 5px 0;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <canvas id="game-canvas"></canvas>
        <div id="score-display">חיסכון: 0 ש"ח</div>
        <div id="date-display">מרץ 2025</div>
        
        <div id="job-offer" class="dialog-box">
            <h3>הצעת עבודה חדשה!</h3>
            <p>האם אתה רוצה להחליף את העבודה שלך בעבודה אחרת מאוד מפתה?</p>
            <button id="yes-btn">כן</button>
            <button id="no-btn" class="no-btn">לא</button>
        </div>
        
        <div id="job-offer-followup" class="dialog-box">
            <h3>אולי תשקול שוב?</h3>
            <p id="followup-text">האם אתה בטוח שאתה לא רוצה להחליף את העבודה שלך?</p>
            <button id="followup-yes-btn">כן</button>
            <button id="followup-no-btn" class="no-btn">לא</button>
        </div>
        
        <div id="game-over">
            <h2>המשחק נגמר!</h2>
            <p id="game-over-reason"></p>
            <p>הגעת לחיסכון של <span id="final-score">0</span> ש"ח</p>
            <button id="restart-btn">התחל מחדש</button>
        </div>
        
        <div id="win-screen">
            <h2>ניצחון!</h2>
            <p>הצלחת להגיע ליעד של 100,000 ש"ח!</p>
            <p>כל הכבוד על ההתמדה וקבלת ההחלטות הנכונות!</p>
            <button id="play-again-btn">שחק שוב</button>
        </div>
    </div>

    <script>
        // Canvas and context setup
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        
        // Set canvas to cover the window
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        // Game variables
        let gameRunning = false;
        let gamePaused = false;
        let score = 0;
        let currentMonth = 0;
        const totalMonths = 20; // From March 2025 to November 2026
        const monthNames = [
            "מרץ 2025", "אפריל 2025", "מאי 2025", "יוני 2025", "יולי 2025", 
            "אוגוסט 2025", "ספטמבר 2025", "אוקטובר 2025", "נובמבר 2025", "דצמבר 2025",
            "ינואר 2026", "פברואר 2026", "מרץ 2026", "אפריל 2026", "מאי 2026", 
            "יוני 2026", "יולי 2026", "אוגוסט 2026", "ספטמבר 2026", "אוקטובר 2026", "נובמבר 2026"
        ];
        
        // 5 minutes per month
        const monthDuration = 300; // 5 minutes in seconds
        const framesPerSecond = 60;
        const frameTime = 1000 / framesPerSecond;
        const framesPerMonth = monthDuration * framesPerSecond;
        let currentMonthTimer = 0;
        
        // Player variables
const player = {
    x: canvas.width * 0.2,
    y: canvas.height * 0.7,
    width: 50,  // הוגדל מ-30
    height: 80, // הוגדל מ-50
    jumping: false,
    jumpPower: 15,
    jumpVelocity: 0,
    gravity: 0.5,
    speed: 5,
    powerUp: false,
    powerUpTime: 0,
    powerUpHits: 0,
    companion: false
};
        
        // Ground variables
        const ground = {
            y: canvas.height * 0.8,
            width: canvas.width,
            height: canvas.height * 0.2
        };
        
        // Obstacles array
        let obstacles = [];
        
        // Powerups array
        let powerups = [];
        
        // Job offer variables
        let jobOfferStage = 0;
        const jobOfferTexts = [
            "האם אתה בטוח שאתה לא רוצה להחליף את העבודה שלך?",
            "היא באמת שווה!",
            "אפשר להרוויח שם יותר כסף!",
            "היא יותר קלילה!"
        ];
        
        // Helper for random number generation
        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
        
        // Create obstacle
function createObstacle() {
    const types = ['person', 'ad', 'food'];
    const type = types[getRandomInt(0, 2)];
    
    let obstacle;
    
    if (type === 'person') {
        const negativeComments = [
            "אתה לא טוב",
            "אתה לא בסדר",
            "אתה לא תצליח",
            "אתה לא יכול",
            "זה גדול עליך"
        ];
        
        obstacle = {
            x: canvas.width,
            y: ground.y - 80,
            width: 50,  // הוגדל מ-30
            height: 80, // הוגדל מ-50
            type: type,
            speed: 5,
            text: negativeComments[getRandomInt(0, negativeComments.length - 1)]
        };
    } else if (type === 'ad') {
        const adTexts = [
            "תבזבז!",
            "תקנה!",
            "אתה חייב בגדים!",
            "אתה חייב חופשה!",
            "אתה חייב כנס! זה יעזור לך לגדול!",
            "זה רק קפה קטן על הדרך!"
        ];
        
        obstacle = {
            x: canvas.width,
            y: ground.y - 70,
            width: 60,  // הוגדל מ-40
            height: 70, // הוגדל מ-40
            type: type,
            speed: 5,
            text: adTexts[getRandomInt(0, adTexts.length - 1)]
        };
    } else if (type === 'food') {
        const foodTypes = [
            "שמן קנולה",
            "ממתקים",
            "משקאות מוגזים",
            "גלידות",
            "חטיפים"
        ];
        
        obstacle = {
            x: canvas.width,
            y: ground.y - 60,
            width: 50,  // הוגדל מ-30
            height: 60, // הוגדל מ-30
            type: type,
            speed: 5,
            text: foodTypes[getRandomInt(0, foodTypes.length - 1)]
        };
    }
    
    obstacles.push(obstacle);
}
        
        // Create powerup
        function createPowerup() {
            const types = ['money', 'earlyRise', 'earlySleep', 'healthyFood', 'dailyExercise'];
            const type = types[getRandomInt(0, types.length - 1)];
            
            let text = '';
            let width = 30;
            let height = 30;
            
            switch(type) {
                case 'money':
                    text = "כסף";
                    break;
                case 'earlyRise':
                    text = "קימה בבוקר מוקדם";
                    break;
                case 'earlySleep':
                    text = "לישון מוקדם";
                    break;
                case 'healthyFood':
                    text = "אוכל בריא";
                    break;
                case 'dailyExercise':
                    text = "אימון יומי";
                    break;
            }
            
            const powerup = {
                x: canvas.width,
                y: getRandomInt(ground.y - 150, ground.y - 40),
                width: width,
                height: height,
                type: type,
                speed: 5,
                text: text
            };
            
            powerups.push(powerup);
        }
        
        // Create companion
        function createCompanion() {
            const companion = {
                x: canvas.width,
                y: ground.y - 50,
                width: 30,
                height: 50,
                speed: 5,
                type: 'companion',
                text: "אני ארוץ איתך ביחד!"
            };
            
            powerups.push(companion);
        }
        
        // Collision detection
        function checkCollision(obj1, obj2) {
            return obj1.x < obj2.x + obj2.width &&
                   obj1.x + obj1.width > obj2.x &&
                   obj1.y < obj2.y + obj2.height &&
                   obj1.y + obj1.height > obj2.y;
        }
        
        // Update game state
        function updateGame() {
            if (!gameRunning || gamePaused) return;
            
            // Update month timer
            currentMonthTimer++;
            
            if (currentMonthTimer >= framesPerMonth) {
                currentMonthTimer = 0;
                currentMonth++;
                
                // Add 5000 ILS to score
                score += 5000;
                
                // Check win condition
                if (score >= 100000) {
                    winGame();
                    return;
                }
                
                // Update display
                updateDisplay();
                
                // Maybe show job offer (20% chance each month)
                if (Math.random() < 0.2) {
                    showJobOffer();
                }
                
                // Create monthly powerups
                const monthlyTypes = ['money', 'earlyRise', 'earlySleep', 'healthyFood', 'dailyExercise'];
                monthlyTypes.forEach(type => {
                    setTimeout(() => {
                        createCustomPowerup(type);
                    }, getRandomInt(1, 10) * 1000);
                });
                
                // Every 2 months (10 minutes), create a companion powerup
                if (currentMonth % 2 === 0) {
                    setTimeout(() => {
                        createCompanion();
                    }, getRandomInt(1, 10) * 1000);
                }
            }
            
            // Update player
            if (player.jumping) {
                player.jumpVelocity += player.gravity;
                player.y += player.jumpVelocity;
                
                if (player.y >= ground.y - player.height) {
                    player.y = ground.y - player.height;
                    player.jumping = false;
                    player.jumpVelocity = 0;
                }
            }
            
            // Update powerup status
            if (player.powerUp) {
                player.powerUpTime--;
                if (player.powerUpTime <= 0) {
                    player.powerUp = false;
                    player.width = 30;
                    player.height = 50;
                    player.powerUpHits = 0;
                }
            }
            
            // Update obstacles
            for (let i = obstacles.length - 1; i >= 0; i--) {
                const obstacle = obstacles[i];
                obstacle.x -= obstacle.speed;
                
                // Check for collision
                if (checkCollision(player, obstacle)) {
                    if (player.powerUp && player.powerUpHits < 2) {
                        // Player has power-up, can survive two hits
                        player.powerUpHits++;
                        obstacles.splice(i, 1);
                    } else {
                        // Game over
                        gameOver("נתקלת במכשול: " + obstacle.text);
                        return;
                    }
                }
                
                // Remove if off-screen
                if (obstacle.x + obstacle.width < 0) {
                    obstacles.splice(i, 1);
                }
            }
            
            // Update powerups
            for (let i = powerups.length - 1; i >= 0; i--) {
                const powerup = powerups[i];
                powerup.x -= powerup.speed;
                
                // Check for collision
                if (checkCollision(player, powerup)) {
                    // Apply powerup effect
                    applyPowerup(powerup);
                    powerups.splice(i, 1);
                }
                
                // Remove if off-screen
                if (powerup.x + powerup.width < 0) {
                    powerups.splice(i, 1);
                }
            }
            
            // Maybe create a new obstacle (1% chance per frame)
            if (Math.random() < 0.01) {
                createObstacle();
            }
            
            // Maybe create a new powerup (0.5% chance per frame)
            if (Math.random() < 0.005) {
                createPowerup();
            }
            
            // Render game
            renderGame();
        }
        
        // Create a specific type of powerup
function createCustomPowerup(type) {
    let text = '';
    let width = 50;  // הוגדל מ-30
    let height = 50; // הוגדל מ-30
    
    switch(type) {
        case 'money':
            text = "כסף";
            break;
        case 'earlyRise':
            text = "קימה בבוקר מוקדם";
            break;
        case 'earlySleep':
            text = "לישון מוקדם";
            break;
        case 'healthyFood':
            text = "אוכל בריא";
            break;
        case 'dailyExercise':
            text = "אימון יומי";
            break;
    }
    
    const powerup = {
        x: canvas.width,
        y: getRandomInt(ground.y - 150, ground.y - 40),
        width: width,
        height: height,
        type: type,
        speed: 5,
        text: text
    };
    
    powerups.push(powerup);
}
        
        // Draw powerups
powerups.forEach(powerup => {
    switch(powerup.type) {
        case 'money':
            ctx.fillStyle = '#FFD700'; // Gold for money
            break;
        case 'earlyRise':
            ctx.fillStyle = '#FFA500'; // Orange for early rise
            break;
        case 'earlySleep':
            ctx.fillStyle = '#8A2BE2'; // Purple for early sleep
            break;
        case 'healthyFood':
            ctx.fillStyle = '#00FF00'; // Green for healthy food
            break;
        case 'dailyExercise':
            ctx.fillStyle = '#FF6347'; // Tomato for exercise
            break;
        case 'companion':
            ctx.fillStyle = '#0000FF'; // Blue for companion
            break;
    }
    ctx.fillRect(powerup.x, powerup.y, powerup.width, powerup.height);
    
    // Draw text
    const bubbleWidth = 120;
    const bubbleHeight = 30;
    const bubbleX = powerup.x + (powerup.width - bubbleWidth) / 2;
    const bubbleY = powerup.y - bubbleHeight - 10;
    
    // Draw bubble background
    ctx.fillStyle = '#FFFFFF';
    ctx.fillRect(bubbleX, bubbleY, bubbleWidth, bubbleHeight);
    ctx.strokeStyle = '#000000';
    ctx.strokeRect(bubbleX, bubbleY, bubbleWidth, bubbleHeight);
    
    // Draw text
    ctx.fillStyle = '#000000';
    ctx.font = '12px Arial';
    ctx.textAlign = 'center';
    ctx.fillText(powerup.text, bubbleX + bubbleWidth/2, bubbleY + bubbleHeight/2 + 4);
    ctx.textAlign = 'start';
});
        
        // Render game
function renderGame() {
    // Clear canvas
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // Draw sky
    ctx.fillStyle = '#87CEEB';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Draw ground
    ctx.fillStyle = '#8B4513';
    ctx.fillRect(0, ground.y, ground.width, ground.height);
    ctx.fillStyle = '#228B22'; // Grass color
    ctx.fillRect(0, ground.y, ground.width, 10);
    
    // Draw player
    ctx.fillStyle = '#000000';
    // Head
    ctx.beginPath();
    ctx.arc(player.x + player.width/2, player.y + player.width/2, player.width/2, 0, Math.PI * 2);
    ctx.fill();
    
    // Body
    ctx.fillRect(player.x + player.width/4, player.y + player.width, player.width/2, player.height - player.width);
    
    // Arms
    ctx.fillRect(player.x - 5, player.y + player.width + 5, player.width/4, player.height/3);
    ctx.fillRect(player.x + player.width - player.width/4 + 5, player.y + player.width + 5, player.width/4, player.height/3);
    
    // Legs
    ctx.fillRect(player.x + player.width/4, player.y + player.height - player.height/3, player.width/5, player.height/3);
    ctx.fillRect(player.x + player.width - player.width/5 - player.width/4, player.y + player.height - player.height/3, player.width/5, player.height/3);
    
    // Power-up effect
    if (player.powerUp) {
        ctx.strokeStyle = '#FFFF00';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.arc(player.x + player.width/2, player.y + player.height/2, player.width*0.8, 0, Math.PI * 2);
        ctx.stroke();
    }
    
    // Draw companion if active
    if (player.companion && player.powerUp) {
        // Draw companion
        ctx.fillStyle = '#0000FF';
        
        // Head
        ctx.beginPath();
        ctx.arc(player.x - 30, player.y + player.width/2, player.width/2, 0, Math.PI * 2);
        ctx.fill();
        
        // Body
        ctx.fillRect(player.x - 30 - player.width/4, player.y + player.width, player.width/2, player.height - player.width);
        
        // Draw speech bubble
        const bubbleWidth = 100;
        const bubbleHeight = 30;
        const bubbleX = player.x - 80;
        const bubbleY = player.y - 40;
        
        // Draw bubble background
        ctx.fillStyle = '#FFFFFF';
        ctx.fillRect(bubbleX, bubbleY, bubbleWidth, bubbleHeight);
        ctx.strokeStyle = '#000000';
        ctx.strokeRect(bubbleX, bubbleY, bubbleWidth, bubbleHeight);
        
        // Draw text
        ctx.fillStyle = '#000000';
        ctx.font = '12px Arial';
        ctx.textAlign = 'center';
        ctx.fillText("אני איתך!", bubbleX + bubbleWidth/2, bubbleY + bubbleHeight/2 + 4);
        ctx.textAlign = 'start';
    }
    
    // Draw obstacles
    obstacles.forEach(obstacle => {
        switch(obstacle.type) {
            case 'person':
                // Draw person
                ctx.fillStyle = '#0000FF';
                
                // Head
                ctx.beginPath();
                ctx.arc(obstacle.x + obstacle.width/2, obstacle.y + obstacle.width/2, obstacle.width/2, 0, Math.PI * 2);
                ctx.fill();
                
                // Body
                ctx.fillRect(obstacle.x + obstacle.width/4, obstacle.y + obstacle.width, obstacle.width/2, obstacle.height - obstacle.width);
                
                // Arms
                ctx.fillRect(obstacle.x - 5, obstacle.y + obstacle.width + 5, obstacle.width/4, obstacle.height/3);
                ctx.fillRect(obstacle.x + obstacle.width - obstacle.width/4 + 5, obstacle.y + obstacle.width + 5, obstacle.width/4, obstacle.height/3);
                
                // Legs
                ctx.fillRect(obstacle.x + obstacle.width/4, obstacle.y + obstacle.height - obstacle.height/3, obstacle.width/5, obstacle.height/3);
                ctx.fillRect(obstacle.x + obstacle.width - obstacle.width/5 - obstacle.width/4, obstacle.y + obstacle.height - obstacle.height/3, obstacle.width/5, obstacle.height/3);
                break;
                
            case 'ad':
                // Draw ad
                ctx.fillStyle = '#FF00FF';
                ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
                
                // Draw ad icon
                ctx.fillStyle = '#FFFFFF';
                ctx.font = '20px Arial';
                ctx.textAlign = 'center';
                ctx.fillText("$", obstacle.x + obstacle.width/2, obstacle.y + obstacle.height/2 + 7);
                ctx.textAlign = 'start';
                break;
                
            case 'food':
                switch(obstacle.text) {
                    case "שמן קנולה":
                        // Draw oil bottle
                        ctx.fillStyle = '#FFD700';
                        ctx.fillRect(obstacle.x + 10, obstacle.y, obstacle.width - 20, obstacle.height);
                        ctx.fillRect(obstacle.x + 15, obstacle.y - 10, obstacle.width - 30, 10);
                        
                        // Draw label
                        ctx.fillStyle = '#FFFFFF';
                        ctx.fillRect(obstacle.x + 15, obstacle.y + 10, obstacle.width - 30, obstacle.height / 2);
                        
                        // Draw text on label
                        ctx.fillStyle = '#000000';
                        ctx.font = '10px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillText("שמן", obstacle.x + obstacle.width/2, obstacle.y + obstacle.height/3);
                        ctx.textAlign = 'start';
                        break;
                        
                    case "ממתקים":
                        // Draw candy
                        ctx.fillStyle = '#FF69B4';
                        ctx.beginPath();
                        ctx.arc(obstacle.x + obstacle.width/2, obstacle.y + obstacle.height/2, obstacle.width/2, 0, Math.PI * 2);
                        ctx.fill();
                        
                        ctx.strokeStyle = '#FFFFFF';
                        ctx.beginPath();
                        ctx.moveTo(obstacle.x + 10, obstacle.y + 10);
                        ctx.lineTo(obstacle.x + obstacle.width - 10, obstacle.y + obstacle.height - 10);
                        ctx.stroke();
                        
                        ctx.beginPath();
                        ctx.moveTo(obstacle.x + obstacle.width - 10, obstacle.y + 10);
                        ctx.lineTo(obstacle.x + 10, obstacle.y + obstacle.height - 10);
                        ctx.stroke();
                        break;
                        
                    case "המבורגר":
                        // Draw burger
                        // Bottom bun
                        ctx.fillStyle = '#CD853F';
                        ctx.beginPath();
                        ctx.ellipse(obstacle.x + obstacle.width/2, obstacle.y + obstacle.height - 10, obstacle.width/2, obstacle.height/6, 0, 0, Math.PI * 2);
                        ctx.fill();
                        
                        // Patty
                        ctx.fillStyle = '#8B4513';
                        ctx.beginPath();
                        ctx.ellipse(obstacle.x + obstacle.width/2, obstacle.y + obstacle.height/2, obstacle.width/2, obstacle.height/6, 0, 0, Math.PI * 2);
                        ctx.fill();
                        
                        // Top bun
                        ctx.fillStyle = '#CD853F';
                        ctx.beginPath();
                        ctx.ellipse(obstacle.x + obstacle.width/2, obstacle.y + 10, obstacle.width/2, obstacle.height/4, 0, 0, Math.PI * 2);
                        ctx.fill();
                        break;
                        
                    case "קפה":
                        // Draw coffee cup
                        // Cup
                        ctx.fillStyle = '#8B4513';
                        ctx.fillRect(obstacle.x + 5, obstacle.y + 10, obstacle.width - 10, obstacle.height - 15);
                        
                        // Handle
                        ctx.beginPath();
                        ctx.arc(obstacle.x + obstacle.width, obstacle.y + obstacle.height/2, obstacle.width/4, Math.PI * 1.5, Math.PI * 0.5);
                        ctx.stroke();
                        
                        // Coffee
                        ctx.fillStyle = '#4B3621';
                        ctx.fillRect(obstacle.x + 10, obstacle.y + 15, obstacle.width - 20, obstacle.height/2);
                        
                        // Steam
                        ctx.strokeStyle = '#FFFFFF';
                        ctx.beginPath();
                        ctx.moveTo(obstacle.x + obstacle.width/2 - 10, obstacle.y + 5);
                        ctx.lineTo(obstacle.x + obstacle.width/2 - 15, obstacle.y - 5);
                        ctx.stroke();
                        
                        ctx.beginPath();
                        ctx.moveTo(obstacle.x + obstacle.width/2, obstacle.y + 5);
                        ctx.lineTo(obstacle.x + obstacle.width/2, obstacle.y - 10);
                        ctx.stroke();
                        
                        ctx.beginPath();
                        ctx.moveTo(obstacle.x + obstacle.width/2 + 10, obstacle.y + 5);
                        ctx.lineTo(obstacle.x + obstacle.width/2 + 15, obstacle.y - 5);
                        ctx.stroke();
                        break;
                        
                    default:
                        // Default food icon (apple)
                        ctx.fillStyle = '#FF0000';
                        ctx.beginPath();
                        ctx.arc(obstacle.x + obstacle.width/2, obstacle.y + obstacle.height/2, obstacle.width/2, 0, Math.PI * 2);
                        ctx.fill();
                        
                        // Stem
                        ctx.fillStyle = '#8B4513';
                        ctx.fillRect(obstacle.x + obstacle.width/2 - 2, obstacle.y + 5, 4, 10);
                        
                        // Leaf
                        ctx.fillStyle = '#00FF00';
                        ctx.beginPath();
                        ctx.ellipse(obstacle.x + obstacle.width/2 + 10, obstacle.y + 10, 8, 5, Math.PI/4, 0, Math.PI * 2);
                        ctx.fill();
                        break;
                }
                break;
                
            case 'morning':
                // Draw sun for morning power-up
                const centerX = obstacle.x + obstacle.width/2;
                const centerY = obstacle.y + obstacle.height/2;
                const radius = Math.min(obstacle.width, obstacle.height) * 0.4;
                
                // Sun circle
                ctx.fillStyle = '#FFCC00';
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
                ctx.fill();
                
                // Sun rays
                ctx.strokeStyle = '#FFCC00';
                ctx.lineWidth = 3;
                for (let i = 0; i < 8; i++) {
                    const angle = i * Math.PI / 4;
                    const rayLength = radius * 0.7;
                    
                    ctx.beginPath();
                    ctx.moveTo(
                        centerX + Math.cos(angle) * radius,
                        centerY + Math.sin(angle) * radius
                    );
                    ctx.lineTo(
                        centerX + Math.cos(angle) * (radius + rayLength),
                        centerY + Math.sin(angle) * (radius + rayLength)
                    );
                    ctx.stroke();
                }
                break;
                
            case 'phone':
                // Draw phone
                ctx.fillStyle = '#000000';
                ctx.fillRect(obstacle.x + 5, obstacle.y + 5, obstacle.width - 10, obstacle.height - 10);
                
                // Screen
                ctx.fillStyle = '#4169E1';
                ctx.fillRect(obstacle.x + 10, obstacle.y + 10, obstacle.width - 20, obstacle.height - 30);
                
                // Home button
                ctx.fillStyle = '#FFFFFF';
                ctx.beginPath();
                ctx.arc(obstacle.x + obstacle.width/2, obstacle.y + obstacle.height - 15, 5, 0, Math.PI * 2);
                ctx.fill();
                break;
                
            default:
                // Default obstacle
                ctx.fillStyle = '#888888';
                ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
                break;
        }
        
        // Draw speech bubble if there is text
        if (obstacle.text && obstacle.type !== 'food') {
            const bubbleWidth = 100;
            const bubbleHeight = 30;
            const bubbleX = obstacle.x + (obstacle.width - bubbleWidth) / 2;
            const bubbleY = obstacle.y - bubbleHeight - 10;
            
            // Draw bubble with rounded corners
            ctx.fillStyle = '#FFFFFF';
            const radius = 5;
            
            ctx.beginPath();
            ctx.moveTo(bubbleX + radius, bubbleY);
            ctx.lineTo(bubbleX + bubbleWidth - radius, bubbleY);
            ctx.quadraticCurveTo(bubbleX + bubbleWidth, bubbleY, bubbleX + bubbleWidth, bubbleY + radius);
            ctx.lineTo(bubbleX + bubbleWidth, bubbleY + bubbleHeight - radius);
            ctx.quadraticCurveTo(bubbleX + bubbleWidth, bubbleY + bubbleHeight, bubbleX + bubbleWidth - radius, bubbleY + bubbleHeight);
            ctx.lineTo(bubbleX + bubbleWidth/2 + 10, bubbleY + bubbleHeight);
            ctx.lineTo(bubbleX + bubbleWidth/2, bubbleY + bubbleHeight + 10);
            ctx.lineTo(bubbleX + bubbleWidth/2 - 10, bubbleY + bubbleHeight);
            ctx.lineTo(bubbleX + radius, bubbleY + bubbleHeight);
            ctx.quadraticCurveTo(bubbleX, bubbleY + bubbleHeight, bubbleX, bubbleY + bubbleHeight - radius);
            ctx.lineTo(bubbleX, bubbleY + radius);
            ctx.quadraticCurveTo(bubbleX, bubbleY, bubbleX + radius, bubbleY);
            ctx.closePath();
            ctx.fill();
            
            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 1;
            ctx.stroke();
            
            // Draw text
            ctx.fillStyle = '#000000';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(obstacle.text, bubbleX + bubbleWidth/2, bubbleY + bubbleHeight/2 + 4);
            ctx.textAlign = 'start';
        }
    });
    
    // Draw powerups
    powerUps.forEach(powerUp => {
        switch(powerUp.type) {
            case 'morning':
                // Draw sun icon for morning power-up
                const centerX = powerUp.x + powerUp.width/2;
                const centerY = powerUp.y + powerUp.height/2;
                const radius = Math.min(powerUp.width, powerUp.height) * 0.4;
                
                // Sun circle
                ctx.fillStyle = '#FFCC00';
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
                ctx.fill();
                
                // Sun rays
                ctx.strokeStyle = '#FFCC00';
                ctx.lineWidth = 3;
                for (let i = 0; i < 8; i++) {
                    const angle = i * Math.PI / 4;
                    const rayLength = radius * 0.7;
                    
                    ctx.beginPath();
                    ctx.moveTo(
                        centerX + Math.cos(angle) * radius,
                        centerY + Math.sin(angle) * radius
                    );
                    ctx.lineTo(
                        centerX + Math.cos(angle) * (radius + rayLength),
                        centerY + Math.sin(angle) * (radius + rayLength)
                    );
                    ctx.stroke();
                }
                break;
                
            case 'exercise':
                // Draw dumbbell for exercise power-up
                ctx.fillStyle = '#888888';
                
                // Left weight
                ctx.beginPath();
                ctx.arc(powerUp.x + powerUp.width * 0.2, powerUp.y + powerUp.height/2, powerUp.width * 0.15, 0, Math.PI * 2);
                ctx.fill();
                
                // Right weight
                ctx.beginPath();
                ctx.arc(powerUp.x + powerUp.width * 0.8, powerUp.y + powerUp.height/2, powerUp.width * 0.15, 0, Math.PI * 2);
                ctx.fill();
                
                // Handle
                ctx.fillRect(powerUp.x + powerUp.width * 0.2, powerUp.y + powerUp.height/2 - 5, powerUp.width * 0.6, 10);
                break;
                
            case 'meditation':
                // Draw meditation icon
                ctx.fillStyle = '#9370DB'; // Medium purple
                
                // Person sitting
                ctx.beginPath();
                ctx.arc(powerUp.x + powerUp.width/2, powerUp.y + powerUp.height * 0.3, powerUp.width * 0.2, 0, Math.PI * 2); // Head
                ctx.fill();
                
                // Body (triangle shape for sitting person)
                ctx.beginPath();
                ctx.moveTo(powerUp.x + powerUp.width/2, powerUp.y + powerUp.height * 0.4);
                ctx.lineTo(powerUp.x + powerUp.width * 0.3, powerUp.y + powerUp.height * 0.9);
                ctx.lineTo(powerUp.x + powerUp.width * 0.7, powerUp.y + powerUp.height * 0.9);
                ctx.closePath();
                ctx.fill();
                
                // Aura
                ctx.strokeStyle = '#9370DB';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(powerUp.x + powerUp.width/2, powerUp.y + powerUp.height/2, powerUp.width * 0.45, 0, Math.PI * 2);
                ctx.stroke();
                break;
                
            case 'water':
                // Draw water glass
                // Glass outline
                ctx.strokeStyle = '#87CEFA'; // Light sky blue
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(powerUp.x + powerUp.width * 0.3, powerUp.y + powerUp.height * 0.2);
                ctx.lineTo(powerUp.x + powerUp.width * 0.2, powerUp.y + powerUp.height * 0.8);
                ctx.lineTo(powerUp.x + powerUp.width * 0.8, powerUp.y + powerUp.height * 0.8);
                ctx.lineTo(powerUp.x + powerUp.width * 0.7, powerUp.y + powerUp.height * 0.2);
                ctx.closePath();
                ctx.stroke();
                
                // Water inside
                ctx.fillStyle = '#87CEFA';
                ctx.beginPath();
                ctx.moveTo(powerUp.x + powerUp.width * 0.25, powerUp.y + powerUp.height * 0.5);
                ctx.lineTo(powerUp.x + powerUp.width * 0.2, powerUp.y + powerUp.height * 0.8);
                ctx.lineTo(powerUp.x + powerUp.width * 0.8, powerUp.y + powerUp.height * 0.8);
                ctx.lineTo(powerUp.x + powerUp.width * 0.75, powerUp.y + powerUp.height * 0.5);
                ctx.closePath();
                ctx.fill();
                
                // Water drops
                ctx.beginPath();
                ctx.arc(powerUp.x + powerUp.width * 0.4, powerUp.y + powerUp.height * 0.3, 3, 0, Math.PI * 2);
                ctx.arc(powerUp.x + powerUp.width * 0.6, powerUp.y + powerUp.height * 0.4, 3, 0, Math.PI * 2);
                ctx.fill();
                break;
                
            case 'friendship':
                // Draw friendship icon (two holding hands)
                ctx.fillStyle = '#FFC0CB'; // Pink
                
                // First person
                ctx.beginPath();
                ctx.arc(powerUp.x + powerUp.width * 0.3, powerUp.y + powerUp.height * 0.3, powerUp.width * 0.15, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillRect(powerUp.x + powerUp.width * 0.25, powerUp.y + powerUp.height * 0.45, powerUp.width * 0.1, powerUp.height * 0.3);
                
                // Second person
                ctx.fillStyle = '#87CEEB'; // Sky blue
                ctx.beginPath();
                ctx.arc(powerUp.x + powerUp.width * 0.7, powerUp.y + powerUp.height * 0.3, powerUp.width * 0.15, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillRect(powerUp.x + powerUp.width * 0.65, powerUp.y + powerUp.height * 0.45, powerUp.width * 0.1, powerUp.height * 0.3);
                
                // Holding hands
                ctx.strokeStyle = '#000000';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(powerUp.x + powerUp.width * 0.35, powerUp.y + powerUp.height * 0.55);
                ctx.lineTo(powerUp.x + powerUp.width * 0.5, powerUp.y + powerUp.height * 0.65);
                ctx.lineTo(powerUp.x + powerUp.width * 0.65, powerUp.y + powerUp.height * 0.55);
                ctx.stroke();
                break;
                
            default:
                // Default power-up (star)
                ctx.fillStyle = '#FFFF00';
                const cx = powerUp.x + powerUp.width/2;
                const cy = powerUp.y + powerUp.height/2;
                const spikes = 5;
                const outerRadius = powerUp.width/2;
                const innerRadius = powerUp.width/4;
                
                ctx.beginPath();
                let rot = Math.PI / 2 * 3;
                let x = cx;
                let y = cy;
                const step = Math.PI / spikes;
                
                ctx.moveTo(cx, cy - outerRadius);
                for (let i = 0; i < spikes; i++) {
                    x = cx + Math.cos(rot) * outerRadius;
                    y = cy + Math.sin(rot) * outerRadius;
                    ctx.lineTo(x, y);
                    rot += step;
                    
                    x = cx + Math.cos(rot) * innerRadius;
                    y = cy + Math.sin(rot) * innerRadius;
                    ctx.lineTo(x, y);
                    rot += step;
                }
                ctx.lineTo(cx, cy - outerRadius);
                ctx.closePath();
                ctx.fill();
                break;
        }
    });
    
    // Draw score and other UI elements
    ctx.fillStyle = '#000000';
    ctx.font = '18px Arial';
    ctx.fillText(`ניקוד: ${score}`, 20, 30);
    
    // Draw power-up meter if active
    if (player.powerUp) {
        const meterWidth = 200;
        const meterHeight = 15;
        const meterX = canvas.width - meterWidth - 20;
        const meterY = 20;
        
        // Draw meter background
        ctx.fillStyle = '#CCCCCC';
        ctx.fillRect(meterX, meterY, meterWidth, meterHeight);
        
        // Calculate remaining time as a percentage
        const remainingPercent = player.powerUpTime / maxPowerUpTime;
        
        // Draw meter fill
        ctx.fillStyle = '#FFFF00';
        ctx.fillRect(meterX, meterY, meterWidth * remainingPercent, meterHeight);
        
        // Draw meter border
        ctx.strokeStyle = '#000000';
        ctx.strokeRect(meterX, meterY, meterWidth, meterHeight);
        
        // Draw label
        ctx.fillStyle = '#000000';
        ctx.font = '12px Arial';
        ctx.fillText('זמן חיזוק', meterX + meterWidth + 5, meterY + meterHeight/2 + 4);
    }
    
    // Draw game messages if any
    if (gameMessage && gameMessageTime > 0) {
        const alpha = Math.min(1, gameMessageTime / 100);
        ctx.globalAlpha = alpha;
        ctx.fillStyle = '#000000';
        ctx.font = '24px Arial';
        ctx.textAlign = 'center';
        ctx.fillText(gameMessage, canvas.width/2, canvas.height/2);
        ctx.textAlign = 'start';
        ctx.globalAlpha = 1.0;
    }
}
        
        // Update display
        function updateDisplay() {
            document.getElementById('score-display').textContent = `חיסכון: ${score.toLocaleString()} ש"ח`;
            document.getElementById('date-display').textContent = monthNames[currentMonth];
        }
        
        // Show job offer
        function showJobOffer() {
            gamePaused = true;
            jobOfferStage = 0;
            document.getElementById('job-offer').style.display = 'block';
        }
        
        // Show job offer followup
        function showJobOfferFollowup() {
            document.getElementById('job-offer').style.display = 'none';
            document.getElementById('followup-text').textContent = jobOfferTexts[jobOfferStage];
            document.getElementById('job-offer-followup').style.display = 'block';
        }
        
        // Game over
        function gameOver(reason) {
            gameRunning = false;
            document.getElementById('game-over-reason').textContent = reason;
            document.getElementById('final-score').textContent = score.toLocaleString();
            document.getElementById('game-over').style.display = 'block';
        }
        
        // Win game
        function winGame() {
            gameRunning = false;
            document.getElementById('win-screen').style.display = 'block';
        }
        
        // Reset game
        function resetGame() {
            gameRunning = true;
            gamePaused = false;
            score = 0;
            currentMonth = 0;
            currentMonthTimer = 0;
            obstacles = [];
            powerups = [];
            
            // Reset player
            player.y = ground.y - player.height;
            player.jumping = false;
            player.jumpVelocity = 0;
            player.powerUp = false;
            player.powerUpTime = 0;
            player.powerUpHits = 0;
            player.companion = false;
            player.width = 30;
            player.height = 50;
            
            // Reset displays
            updateDisplay();
            
            // Hide all dialogs
            document.getElementById('job-offer').style.display = 'none';
            document.getElementById('job-offer-followup').style.display = 'none';
            document.getElementById('game-over').style.display = 'none';
            document.getElementById('win-screen').style.display = 'none';
        }
        
        // Jump function
        function jump() {
            if (!player.jumping) {
                player.jumping = true;
                player.jumpVelocity = -player.jumpPower;
            }
        }
        
        // Handle window resize
        window.addEventListener('resize', function() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            ground.y = canvas.height * 0.8;
            ground.width = canvas.width;
            ground.height = canvas.height * 0.2;
            player.y = ground.y - player.height;
        });
        
        // Event listeners
        document.addEventListener('keydown', function(event) {
            if (event.code === 'Space') {
                if (gameRunning && !gamePaused) {
                    jump();
                }
            }
        });
        
        canvas.addEventListener('click', function() {
            if (gameRunning && !gamePaused) {
                jump();
            }
        });
        
        // Touch events for mobile
        canvas.addEventListener('touchstart', function(event) {
            event.preventDefault();
            if (gameRunning && !gamePaused) {
                jump();
            }
        });
        
        // Job offer buttons
        document.getElementById('yes-btn').addEventListener('click', function() {
            gameOver("החלפת עבודה? איבדת את היציבות הכלכלית!");
        });
        
        document.getElementById('no-btn').addEventListener('click', function() {
            showJobOfferFollowup();
        });
        
        document.getElementById('followup-yes-btn').addEventListener('click', function() {
            gameOver("החלפת עבודה? איבדת את היציבות הכלכלית!");
        });
        
        document.getElementById('followup-no-btn').addEventListener('click', function() {
            jobOfferStage++;
            if (jobOfferStage < jobOfferTexts.length) {
                document.getElementById('followup-text').textContent = jobOfferTexts[jobOfferStage];
            } else {
                document.getElementById('job-offer-followup').style.display = 'none';
                gamePaused = false;
            }
        });
        
        // Game over buttons
        document.getElementById('restart-btn').addEventListener('click', function() {
            resetGame();
        });
        
        document.getElementById('play-again-btn').addEventListener('click', function() {
            resetGame();
        });
        
        // Start game
        function startGame() {
            resetGame();
            
            // Game loop
            setInterval(updateGame, frameTime);
        }
        
        // Start the game when the page loads
        window.onload = function() {
            startGame();
        };
    </script>
</body>
</html>
