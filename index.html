// HTML
<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>משחק החיסכון</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #f0f0f0;
            font-family: Arial, sans-serif;
        }
        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }
        #game-canvas {
            position: absolute;
            top: 0;
            left: 0;
            background-color: #87CEEB;
        }
        #score-display {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 5px;
            font-size: 18px;
            font-weight: bold;
            z-index: 10;
        }
        #date-display {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 5px;
            font-size: 18px;
            font-weight: bold;
            z-index: 10;
        }
        .dialog-box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            border: 2px solid #333;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            z-index: 100;
            display: none;
            width: 80%;
            max-width: 400px;
        }
        .dialog-box h3 {
            margin-top: 0;
        }
        .dialog-box button {
            margin: 5px;
            padding: 8px 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        .dialog-box button:hover {
            background-color: #45a049;
        }
        .dialog-box button.no-btn {
            background-color: #f44336;
        }
        .dialog-box button.no-btn:hover {
            background-color: #d32f2f;
        }
        #game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            z-index: 100;
            display: none;
        }
        #game-over button {
            margin-top: 20px;
            padding: 8px 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        #win-screen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            z-index: 100;
            display: none;
        }
        #win-screen button {
            margin-top: 20px;
            padding: 8px 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        .speech-bubble {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.9);
            border: 2px solid #333;
            border-radius: 10px;
            padding: 5px;
            font-size: 12px;
            width: 80px;
            text-align: center;
            z-index: 5;
        }
        .speech-bubble:after {
            content: "";
            position: absolute;
            bottom: -10px;
            left: 50%;
            margin-left: -5px;
            border-width: 10px 5px 0;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <canvas id="game-canvas"></canvas>
        <div id="score-display">חיסכון: 0 ש"ח</div>
        <div id="date-display">מרץ 2025</div>
        
        <div id="job-offer" class="dialog-box">
            <h3>הצעת עבודה חדשה!</h3>
            <p>האם אתה רוצה להחליף את העבודה שלך בעבודה אחרת מאוד מפתה?</p>
            <button id="yes-btn">כן</button>
            <button id="no-btn" class="no-btn">לא</button>
        </div>
        
        <div id="job-offer-followup" class="dialog-box">
            <h3>אולי תשקול שוב?</h3>
            <p id="followup-text">האם אתה בטוח שאתה לא רוצה להחליף את העבודה שלך?</p>
            <button id="followup-yes-btn">כן</button>
            <button id="followup-no-btn" class="no-btn">לא</button>
        </div>
        
        <div id="game-over">
            <h2>המשחק נגמר!</h2>
            <p id="game-over-reason"></p>
            <p>הגעת לחיסכון של <span id="final-score">0</span> ש"ח</p>
            <button id="restart-btn">התחל מחדש</button>
        </div>
        
        <div id="win-screen">
            <h2>ניצחון!</h2>
            <p>הצלחת להגיע ליעד של 100,000 ש"ח!</p>
            <p>כל הכבוד על ההתמדה וקבלת ההחלטות הנכונות!</p>
            <button id="play-again-btn">שחק שוב</button>
        </div>
    </div>

    <script>
        // Canvas and context setup
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        
        // Set canvas to cover the window
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        // Game variables
        let gameRunning = false;
        let gamePaused = false;
        let score = 0;
        let currentMonth = 0;
        const totalMonths = 20; // From March 2025 to November 2026
        const monthNames = [
            "מרץ 2025", "אפריל 2025", "מאי 2025", "יוני 2025", "יולי 2025", 
            "אוגוסט 2025", "ספטמבר 2025", "אוקטובר 2025", "נובמבר 2025", "דצמבר 2025",
            "ינואר 2026", "פברואר 2026", "מרץ 2026", "אפריל 2026", "מאי 2026", 
            "יוני 2026", "יולי 2026", "אוגוסט 2026", "ספטמבר 2026", "אוקטובר 2026", "נובמבר 2026"
        ];
        
        // 5 minutes per month
        const monthDuration = 300; // 5 minutes in seconds
        const framesPerSecond = 60;
        const frameTime = 1000 / framesPerSecond;
        const framesPerMonth = monthDuration * framesPerSecond;
        let currentMonthTimer = 0;
        
        // Player variables
        const player = {
            x: canvas.width * 0.2,
            y: canvas.height * 0.7,
            width: 30,
            height: 50,
            jumping: false,
            jumpPower: 15,
            jumpVelocity: 0,
            gravity: 0.5,
            speed: 5,
            powerUp: false,
            powerUpTime: 0,
            powerUpHits: 0,
            companion: false
        };
        
        // Ground variables
        const ground = {
            y: canvas.height * 0.8,
            width: canvas.width,
            height: canvas.height * 0.2
        };
        
        // Obstacles array
        let obstacles = [];
        
        // Powerups array
        let powerups = [];
        
        // Job offer variables
        let jobOfferStage = 0;
        const jobOfferTexts = [
            "האם אתה בטוח שאתה לא רוצה להחליף את העבודה שלך?",
            "היא באמת שווה!",
            "אפשר להרוויח שם יותר כסף!",
            "היא יותר קלילה!"
        ];
        
        // Helper for random number generation
        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
        
        // Create obstacle
        function createObstacle() {
            const types = ['person', 'ad', 'food'];
            const type = types[getRandomInt(0, 2)];
            
            let obstacle;
            
            if (type === 'person') {
                const negativeComments = [
                    "אתה לא טוב",
                    "אתה לא בסדר",
                    "אתה לא תצליח",
                    "אתה לא יכול",
                    "זה גדול עליך"
                ];
                
                obstacle = {
                    x: canvas.width,
                    y: ground.y - 50,
                    width: 30,
                    height: 50,
                    type: type,
                    speed: 5,
                    text: negativeComments[getRandomInt(0, negativeComments.length - 1)]
                };
            } else if (type === 'ad') {
                const adTexts = [
                    "תבזבז!",
                    "תקנה!",
                    "אתה חייב בגדים!",
                    "אתה חייב חופשה!",
                    "אתה חייב כנס! זה יעזור לך לגדול!",
                    "זה רק קפה קטן על הדרך!"
                ];
                
                obstacle = {
                    x: canvas.width,
                    y: ground.y - 40,
                    width: 40,
                    height: 40,
                    type: type,
                    speed: 5,
                    text: adTexts[getRandomInt(0, adTexts.length - 1)]
                };
            } else if (type === 'food') {
                const foodTypes = [
                    "שמן קנולה",
                    "ממתקים",
                    "משקאות מוגזים",
                    "גלידות",
                    "חטיפים"
                ];
                
                obstacle = {
                    x: canvas.width,
                    y: ground.y - 30,
                    width: 30,
                    height: 30,
                    type: type,
                    speed: 5,
                    text: foodTypes[getRandomInt(0, foodTypes.length - 1)]
                };
            }
            
            obstacles.push(obstacle);
        }
        
        // Create powerup
        function createPowerup() {
            const types = ['money', 'earlyRise', 'earlySleep', 'healthyFood', 'dailyExercise'];
            const type = types[getRandomInt(0, types.length - 1)];
            
            let text = '';
            let width = 30;
            let height = 30;
            
            switch(type) {
                case 'money':
                    text = "כסף";
                    break;
                case 'earlyRise':
                    text = "קימה בבוקר מוקדם";
                    break;
                case 'earlySleep':
                    text = "לישון מוקדם";
                    break;
                case 'healthyFood':
                    text = "אוכל בריא";
                    break;
                case 'dailyExercise':
                    text = "אימון יומי";
                    break;
            }
            
            const powerup = {
                x: canvas.width,
                y: getRandomInt(ground.y - 150, ground.y - 40),
                width: width,
                height: height,
                type: type,
                speed: 5,
                text: text
            };
            
            powerups.push(powerup);
        }
        
        // Create companion
        function createCompanion() {
            const companion = {
                x: canvas.width,
                y: ground.y - 50,
                width: 30,
                height: 50,
                speed: 5,
                type: 'companion',
                text: "אני ארוץ איתך ביחד!"
            };
            
            powerups.push(companion);
        }
        
        // Collision detection
        function checkCollision(obj1, obj2) {
            return obj1.x < obj2.x + obj2.width &&
                   obj1.x + obj1.width > obj2.x &&
                   obj1.y < obj2.y + obj2.height &&
                   obj1.y + obj1.height > obj2.y;
        }
        
        // Update game state
        function updateGame() {
            if (!gameRunning || gamePaused) return;
            
            // Update month timer
            currentMonthTimer++;
            
            if (currentMonthTimer >= framesPerMonth) {
                currentMonthTimer = 0;
                currentMonth++;
                
                // Add 5000 ILS to score
                score += 5000;
                
                // Check win condition
                if (score >= 100000) {
                    winGame();
                    return;
                }
                
                // Update display
                updateDisplay();
                
                // Maybe show job offer (20% chance each month)
                if (Math.random() < 0.2) {
                    showJobOffer();
                }
                
                // Create monthly powerups
                const monthlyTypes = ['money', 'earlyRise', 'earlySleep', 'healthyFood', 'dailyExercise'];
                monthlyTypes.forEach(type => {
                    setTimeout(() => {
                        createCustomPowerup(type);
                    }, getRandomInt(1, 10) * 1000);
                });
                
                // Every 2 months (10 minutes), create a companion powerup
                if (currentMonth % 2 === 0) {
                    setTimeout(() => {
                        createCompanion();
                    }, getRandomInt(1, 10) * 1000);
                }
            }
            
            // Update player
            if (player.jumping) {
                player.jumpVelocity += player.gravity;
                player.y += player.jumpVelocity;
                
                if (player.y >= ground.y - player.height) {
                    player.y = ground.y - player.height;
                    player.jumping = false;
                    player.jumpVelocity = 0;
                }
            }
            
            // Update powerup status
            if (player.powerUp) {
                player.powerUpTime--;
                if (player.powerUpTime <= 0) {
                    player.powerUp = false;
                    player.width = 30;
                    player.height = 50;
                    player.powerUpHits = 0;
                }
            }
            
            // Update obstacles
            for (let i = obstacles.length - 1; i >= 0; i--) {
                const obstacle = obstacles[i];
                obstacle.x -= obstacle.speed;
                
                // Check for collision
                if (checkCollision(player, obstacle)) {
                    if (player.powerUp && player.powerUpHits < 2) {
                        // Player has power-up, can survive two hits
                        player.powerUpHits++;
                        obstacles.splice(i, 1);
                    } else {
                        // Game over
                        gameOver("נתקלת במכשול: " + obstacle.text);
                        return;
                    }
                }
                
                // Remove if off-screen
                if (obstacle.x + obstacle.width < 0) {
                    obstacles.splice(i, 1);
                }
            }
            
            // Update powerups
            for (let i = powerups.length - 1; i >= 0; i--) {
                const powerup = powerups[i];
                powerup.x -= powerup.speed;
                
                // Check for collision
                if (checkCollision(player, powerup)) {
                    // Apply powerup effect
                    applyPowerup(powerup);
                    powerups.splice(i, 1);
                }
                
                // Remove if off-screen
                if (powerup.x + powerup.width < 0) {
                    powerups.splice(i, 1);
                }
            }
            
            // Maybe create a new obstacle (1% chance per frame)
            if (Math.random() < 0.01) {
                createObstacle();
            }
            
            // Maybe create a new powerup (0.5% chance per frame)
            if (Math.random() < 0.005) {
                createPowerup();
            }
            
            // Render game
            renderGame();
        }
        
        // Create a specific type of powerup
        function createCustomPowerup(type) {
            let text = '';
            let width = 30;
            let height = 30;
            
            switch(type) {
                case 'money':
                    text = "כסף";
                    break;
                case 'earlyRise':
                    text = "קימה בבוקר מוקדם";
                    break;
                case 'earlySleep':
                    text = "לישון מוקדם";
                    break;
                case 'healthyFood':
                    text = "אוכל בריא";
                    break;
                case 'dailyExercise':
                    text = "אימון יומי";
                    break;
            }
            
            const powerup = {
                x: canvas.width,
                y: getRandomInt(ground.y - 150, ground.y - 40),
                width: width,
                height: height,
                type: type,
                speed: 5,
                text: text
            };
            
            powerups.push(powerup);
        }
        
        // Apply powerup effect
        function applyPowerup(powerup) {
            switch(powerup.type) {
                case 'money':
                    score += 500;
                    updateDisplay();
                    break;
                case 'earlyRise':
                case 'earlySleep':
                case 'healthyFood':
                case 'dailyExercise':
                    // These powerups make the player stronger
                    player.powerUp = true;
                    player.powerUpTime = 600; // 10 seconds
                    player.width = 40;
                    player.height = 60;
                    break;
                case 'companion':
                    // Companion gives player ability to survive 2 hits
                    player.powerUp = true;
                    player.powerUpTime = 1800; // 30 seconds
                    player.width = 40;
                    player.height = 60;
                    player.companion = true;
                    break;
            }
        }
        
        // Render game
        function renderGame() {
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw sky
            ctx.fillStyle = '#87CEEB';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw ground
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(0, ground.y, ground.width, ground.height);
            
            // Draw player
            if (player.powerUp) {
                ctx.fillStyle = '#FF9900'; // Orange for powered up
            } else {
                ctx.fillStyle = '#FF0000'; // Red for normal
            }
            ctx.fillRect(player.x, player.y, player.width, player.height);
            
            // Draw companion if active
            if (player.companion && player.powerUp) {
                ctx.fillStyle = '#0000FF'; // Blue for companion
                ctx.fillRect(player.x - 40, player.y, 30, 50);
                
                // Draw speech bubble
                ctx.fillStyle = '#FFFFFF';
                ctx.fillRect(player.x - 50, player.y - 30, 100, 20);
                ctx.fillStyle = '#000000';
                ctx.font = '12px Arial';
                ctx.fillText("אני איתך!", player.x - 40, player.y - 15);
            }
            
            // Draw obstacles
            ctx.fillStyle = '#000000';
            obstacles.forEach(obstacle => {
                // Draw obstacle
                switch(obstacle.type) {
                    case 'person':
                        ctx.fillStyle = '#0000FF'; // Blue for person
                        break;
                    case 'ad':
                        ctx.fillStyle = '#FF00FF'; // Magenta for ad
                        break;
                    case 'food':
                        ctx.fillStyle = '#00FF00'; // Green for food
                        break;
                }
                ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
                
                // Draw speech bubble
                ctx.fillStyle = '#FFFFFF';
                ctx.fillRect(obstacle.x - 30, obstacle.y - 30, 100, 20);
                ctx.fillStyle = '#000000';
                ctx.font = '10px Arial';
                ctx.fillText(obstacle.text, obstacle.x - 25, obstacle.y - 15);
            });
            
            // Draw powerups
            powerups.forEach(powerup => {
                switch(powerup.type) {
                    case 'money':
                        ctx.fillStyle = '#FFD700'; // Gold for money
                        break;
                    case 'earlyRise':
                        ctx.fillStyle = '#FFA500'; // Orange for early rise
                        break;
                    case 'earlySleep':
                        ctx.fillStyle = '#8A2BE2'; // Purple for early sleep
                        break;
                    case 'healthyFood':
                        ctx.fillStyle = '#00FF00'; // Green for healthy food
                        break;
                    case 'dailyExercise':
                        ctx.fillStyle = '#FF6347'; // Tomato for exercise
                        break;
                    case 'companion':
                        ctx.fillStyle = '#0000FF'; // Blue for companion
                        break;
                }
                ctx.fillRect(powerup.x, powerup.y, powerup.width, powerup.height);
                
                // Draw text
                ctx.fillStyle = '#FFFFFF';
                ctx.fillRect(powerup.x - 30, powerup.y - 30, 100, 20);
                ctx.fillStyle = '#000000';
                ctx.font = '10px Arial';
                ctx.fillText(powerup.text, powerup.x - 25, powerup.y - 15);
            });
        }
        
        // Update display
        function updateDisplay() {
            document.getElementById('score-display').textContent = `חיסכון: ${score.toLocaleString()} ש"ח`;
            document.getElementById('date-display').textContent = monthNames[currentMonth];
        }
        
        // Show job offer
        function showJobOffer() {
            gamePaused = true;
            jobOfferStage = 0;
            document.getElementById('job-offer').style.display = 'block';
        }
        
        // Show job offer followup
        function showJobOfferFollowup() {
            document.getElementById('job-offer').style.display = 'none';
            document.getElementById('followup-text').textContent = jobOfferTexts[jobOfferStage];
            document.getElementById('job-offer-followup').style.display = 'block';
        }
        
        // Game over
        function gameOver(reason) {
            gameRunning = false;
            document.getElementById('game-over-reason').textContent = reason;
            document.getElementById('final-score').textContent = score.toLocaleString();
            document.getElementById('game-over').style.display = 'block';
        }
        
        // Win game
        function winGame() {
            gameRunning = false;
            document.getElementById('win-screen').style.display = 'block';
        }
        
        // Reset game
        function resetGame() {
            gameRunning = true;
            gamePaused = false;
            score = 0;
            currentMonth = 0;
            currentMonthTimer = 0;
            obstacles = [];
            powerups = [];
            
            // Reset player
            player.y = ground.y - player.height;
            player.jumping = false;
            player.jumpVelocity = 0;
            player.powerUp = false;
            player.powerUpTime = 0;
            player.powerUpHits = 0;
            player.companion = false;
            player.width = 30;
            player.height = 50;
            
            // Reset displays
            updateDisplay();
            
            // Hide all dialogs
            document.getElementById('job-offer').style.display = 'none';
            document.getElementById('job-offer-followup').style.display = 'none';
            document.getElementById('game-over').style.display = 'none';
            document.getElementById('win-screen').style.display = 'none';
        }
        
        // Jump function
        function jump() {
            if (!player.jumping) {
                player.jumping = true;
                player.jumpVelocity = -player.jumpPower;
            }
        }
        
        // Handle window resize
        window.addEventListener('resize', function() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            ground.y = canvas.height * 0.8;
            ground.width = canvas.width;
            ground.height = canvas.height * 0.2;
            player.y = ground.y - player.height;
        });
        
        // Event listeners
        document.addEventListener('keydown', function(event) {
            if (event.code === 'Space') {
                if (gameRunning && !gamePaused) {
                    jump();
                }
            }
        });
        
        canvas.addEventListener('click', function() {
            if (gameRunning && !gamePaused) {
                jump();
            }
        });
        
        // Touch events for mobile
        canvas.addEventListener('touchstart', function(event) {
            event.preventDefault();
            if (gameRunning && !gamePaused) {
                jump();
            }
        });
        
        // Job offer buttons
        document.getElementById('yes-btn').addEventListener('click', function() {
            gameOver("החלפת עבודה? איבדת את היציבות הכלכלית!");
        });
        
        document.getElementById('no-btn').addEventListener('click', function() {
            showJobOfferFollowup();
        });
        
        document.getElementById('followup-yes-btn').addEventListener('click', function() {
            gameOver("החלפת עבודה? איבדת את היציבות הכלכלית!");
        });
        
        document.getElementById('followup-no-btn').addEventListener('click', function() {
            jobOfferStage++;
            if (jobOfferStage < jobOfferTexts.length) {
                document.getElementById('followup-text').textContent = jobOfferTexts[jobOfferStage];
            } else {
                document.getElementById('job-offer-followup').style.display = 'none';
                gamePaused = false;
            }
        });
        
        // Game over buttons
        document.getElementById('restart-btn').addEventListener('click', function() {
            resetGame();
        });
        
        document.getElementById('play-again-btn').addEventListener('click', function() {
            resetGame();
        });
        
        // Start game
        function startGame() {
            resetGame();
            
            // Game loop
            setInterval(updateGame, frameTime);
        }
        
        // Start the game when the page loads
        window.onload = function() {
            startGame();
        };
    </script>
</body>
</html>
